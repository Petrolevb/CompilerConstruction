#!/bin/bash

if [ $# -lt 2 ]
then
    echo "Nombre d'arguments invalides"
    echo "Utilisation :"
    echo "./jlc -s fileName"
    echo "./jlc -b JVM fileName"
    echo "./jlc -b LLVM fileName"
fi

if [ $1 == "-b" ]
then
    if [ $2 == "JVM" ]
    then
	lib/jlc $1 $2 $3
	str="$3"
	fileName=${str/%jl/j}
	java -jar lib/jasmin.jar $fileName
    else
	lib/jlc $1 $2 $3
	str="$3"
	fileName=${str/%jl/ll}
	llvm-as fileName
	fileOpt=${fileName/%.ll/Opt.bc}
	opt -std-compile-opt fileName > llvmFileOpt.bc
	fileAs=${fileName/%ll/bc}
	llvm-ld fileAs lib/runtime.bc
	#llvm-ld llvmFileOpt.bc lib/runtime.bc
    fi
else
    lib.jlc $1 $2
fi